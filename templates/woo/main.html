<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub - ë©”ì¸ í˜ì´ì§€</title>
    {% include "includes/_style.html" %}
</head>

<script>
function renderRanking(ulId, data) {
    let html = "";

    data.forEach((row, idx) => {
        let imgSrc = row.item_img 
            ? (row.item_img.endsWith(".png") || row.item_img.endsWith(".jpg") || row.item_img.endsWith(".jpeg")
                ? "/static/img/_item/" + row.item_img
                : row.item_img)
            : "/static/img/default.png";

        html += `
            <li class="rank_list">
                <span class="rank_img">
                    <img src="${imgSrc}" style="width:30px; height:30px; object-fit:cover;">
                </span>
                <span class="rank">${idx + 1}</span>
                <span class="keyword">${row.keyword}</span>
                <span class="score">${row.total_score}</span>
            </li>
        `;
    });

    $(`#${ulId}`).html(html);
}

function loadRanking() {
    const IS_LOGIN = document.body.dataset.isLogin === "True";

    //ì „ì²´ í‚¤ì›Œë“œ ë­í‚¹
    $.get("/api/tag_ranking/all", function(data) {
        renderRanking("ranking-tag", data);
    });

    //ê°œì¸ í‚¤ì›Œë“œ ë­í‚¹(ë¡œê·¸ì¸í•œ ìƒíƒœì—ì„œ ë§Œ)
    if (IS_LOGIN) {
        $.get("/api/tag_ranking/user", function(res) {
            renderRanking("ranking-user-tag", res.rows);
        });
    }
}


setInterval(loadRanking, 3000);
loadRanking();
</script>
<body>
    <header>
        {% include "includes/_header.html" %}
        {% include "includes/_catenav.html" %}
    </header>

    <div class="content-wrapper layout-anchor" style="display: flex; justify-content: space-between; align-items: flex-start;">
        <main style="flex: 1;">

{% include "includes/_carousel.html" %}

{# ============================
   ë¡œê·¸ì¸ ì‚¬ìš©ì
============================ #}
{% if session["user"] %}

    {# ìœ ì‚¬ê·¸ë£¹ ë°ì´í„° ìˆìŒ #}
    {% if weighted_recommendations_list is defined and weighted_recommendations_list|length > 0 %}

        <!-- ìœ ì‚¬ê·¸ë£¹ í‰ì  ê¸°ì¤€ -->
        {% include "mhi/list.html" %}

        <br>

        <!-- ìœ ì‚¬ê·¸ë£¹ êµ¬ë§¤íšŸìˆ˜ ê¸°ì¤€ -->
        <h4 class="mb-3">
            <span class="tooltip-container">
                ğŸ“Œ ìœ ì‚¬ê·¸ë£¹ì˜ êµ¬ë§¤íšŸìˆ˜ ê¸°ì¤€
                <span class="tooltip-text">
                    ìœ ì‚¬ê·¸ë£¹(ë³¸ì¸ë‚˜ì´Â±5, ë™ì¼ì„±ë³„)ì´ êµ¬ë§¤í•œ ì•„ì´í…œ ì¤‘
                    êµ¬ë§¤íšŸìˆ˜ê°€ ë§ì€ ì•„ì´í…œì„ ì¶œë ¥
                </span>
            </span>
        </h4>

        <div class="container mt-3">
            <div class="row">
                <div class="col-md-8">
                    {% include "mhi/group_recommend.html" %}
                </div>
                <div class="col-md-4">
                    {% include "mhi/group_g.html" %}
                </div>
            </div>
        </div>

        <br><br>

        <!-- ìµœì¢… ì¶”ì²œ ê·¸ë˜í”„ -->
        {% include "mhi/rank.html" %}
        {% include "mhi/rank_g.html" %}

        {# ìœ ì‚¬ê·¸ë£¹ ë°ì´í„° ì—†ìŒ #}
        {% else %}
            {% include "mhi/nogroup.html" %}
        {% endif %}

        {# ============================
        ë¡œê·¸ì•„ì›ƒ ì‚¬ìš©ì
        ============================ #}
        {% else %}

            {% include "mhi/list_logout.html" %}
            <br>
            {% include "includes/_nologinformaintochart.html" %}

        {% endif %}

            

        </main>
        <aside id="rank" class="ranking-box">
            <div class="rank_align">
                <img class="rank_logo" src="/static/img/hub_logo.png">
            </div>
            <div class="rank_center">
                <div class="rank_title">ğŸ‘‘ì „ì²´ ì¸ê¸° íƒœê·¸ ë­í‚¹</div>
                <ul id="ranking-tag" class="rank_container"></ul>

                {% if session['user'] %}
                <div class="rank_title">ğŸ‘‘ê°œì¸ íƒœê·¸ ë­í‚¹</div>
                <ul id="ranking-user-tag" class="rank_container"></ul>
                {% endif %}
            </div>
        </aside>
    </div>
</html>